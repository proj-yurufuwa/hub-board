machine:
  timezone:
    Asia/Tokyo
  ruby:
    version: 2.4.0
  services:
    - "docker"
dependencies:
  override:
    - bundle install:
        timeout: 180
    - docker run --detach --publish ${MYSQL_PORT}:3306 --env MYSQL_ALLOW_EMPTY_PASSWORD=yes mysql:${MYSQL_VERSION}
    - mysqladmin --host=127.0.0.1 --port=${MYSQL_PORT} --user=${MYSQL_USER} --wait ping
database:
  override:
    - bundle exec rake db:create db:schema:load RAILS_ENV=test
    - bundle exec rake db:migrate RAILS_ENV=test
test:
  post:
    - bundle exec rspec -p spec/
